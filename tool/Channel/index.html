<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â£∞ÈÅìÊµãËØïÂ∑•ÂÖ∑</title>
    <style>
        :root {
            --theme-bg: linear-gradient(135deg, #1a2a6c, #2a4b8c);
            --highlight: #ff8a00;
            --btn-bg: linear-gradient(to right, #00c9ff, #92fe9d);
            --btn-stop: linear-gradient(to right, #ff416c, #ff4b2b);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
        }

        body {
            background: var(--theme-bg);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        main {
            max-width: 800px;
            width: 100%;
            background: rgba(91, 91, 91, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .description {
            font-size: 1.1rem;
            opacity: .9;
        }

        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            background: rgba(0, 200, 83, .2);
            color: #00c853;
        }

        .note {
            font-size: .9rem;
            opacity: .7;
            margin-top: 10px;
            color: var(--highlight);
        }

        /* visualization */
        .visualization {
            height: 200px;
            margin: 30px 0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .speakers {
            display: flex;
            justify-content: space-between;
            width: 100%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        .speaker {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, .1);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: .3s;
        }

        .speaker.active {
            background: rgba(255, 138, 0, .3);
            box-shadow: 0 0 20px rgba(255, 138, 0, .5);
        }

        .sound-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--highlight);
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px rgba(255, 138, 0, .8);
            transition: left .2s ease;
        }

        /* balance control */
        .slider-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .slider-label {
            width: 60px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
        }

        input[type="range"] {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #ff416c, #ff8a00, #00c9ff);
            border-radius: 10px;
            outline: none;
            margin: 0 15px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, .5);
        }

        .balance-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--highlight);
        }

        /* buttons */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform .2s, box-shadow .2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, .3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, .4);
        }

        .play-btn {
            background: var(--btn-bg);
            color: #1a2a6c;
        }

        .play-btn.playing {
            background: linear-gradient(to right, #00c853, #00e676);
            color: white;
        }

        .stop-btn {
            background: var(--btn-stop);
            color: white;
        }

        .test-sounds {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .sound-btn {
            padding: 10px 20px;
            border-radius: 30px;
            background: rgba(255, 255, 255, .1);
            border: 1px solid rgba(255, 255, 255, .2);
            cursor: pointer;
            transition: .3s;
        }

        .sound-btn.active,
        .sound-btn:hover {
            background: rgba(255, 138, 0, .5);
        }

        /* switch */
        .playback-controls {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-round {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider-round:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: #fff;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider-round {
            background: #00c853;
        }

        input:checked+.slider-round:before {
            transform: translateX(30px);
        }

        @media(max-width:600px) {
            main {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .speaker {
                width: 60px;
                height: 60px;
            }

            button {
                padding: 10px 20px;
            }
        }
    </style>
</head>

<body>
    <main>
        <header>
            <h1>Â£∞ÈÅìÊµãËØïÂ∑•ÂÖ∑</h1>
            <p class="note">ÊèêÁ§∫ÔºöËØ∑‰ΩøÁî®ËÄ≥Êú∫‰ª•Ëé∑ÂæóÊúÄ‰Ω≥‰ΩìÈ™å</p>
        </header>

        <section class="visualization">
            <div class="speakers">
                <div class="speaker left">
                    <div>üîà</div>
                    <div>Â∑¶Â£∞ÈÅì</div>
                </div>
                <div class="speaker right">
                    <div>üîà</div>
                    <div>Âè≥Â£∞ÈÅì</div>
                </div>
            </div>
            <div class="sound-indicator" id="sound-indicator"></div>
        </section>

        <section class="balance-control">
            <div class="slider-container">
                <div class="slider-label">Â∑¶</div>
                <input type="range" min="-100" max="100" value="0" id="balance-slider">
                <div class="slider-label">Âè≥</div>
            </div>
            <div class="balance-value" id="balance-value">Âπ≥Ë°°: Â±Ö‰∏≠</div>
        </section>

        <div class="playback-controls">
            <span>Âæ™ÁéØÊí≠Êîæ:</span>
            <label class="switch">
                <input type="checkbox" id="loop-toggle" checked>
                <span class="slider-round"></span>
            </label>
        </div>

        <div class="controls">
            <button id="test-button" class="play-btn">ÊµãËØïÂ£∞Èü≥</button>
            <button id="stop-button" class="stop-btn">ÂÅúÊ≠¢</button>
        </div>

        <div class="test-sounds">
            <button class="sound-btn active" data-sound="sine">Ê≠£Âº¶Ê≥¢</button>
            <button class="sound-btn" data-sound="white">ÁôΩÂô™Â£∞</button>
            <button class="sound-btn" data-sound="ping">pingÂ£∞</button>
            <button class="sound-btn" data-sound="sweep">Êâ´È¢ëÈü≥</button>
        </div>
    </main>

    <script>
        const balanceSlider = document.getElementById('balance-slider');
        const balanceValue = document.getElementById('balance-value');
        const indicator = document.getElementById('sound-indicator');
        const testBtn = document.getElementById('test-button');
        const stopBtn = document.getElementById('stop-button');
        const soundBtns = document.querySelectorAll('.sound-btn');
        const loopToggle = document.getElementById('loop-toggle');
        const leftSpk = document.querySelector('.speaker.left');
        const rightSpk = document.querySelector('.speaker.right');

        let ctx, source, panNode, gain, loop;
        let isPlaying = false;
        let soundType = 'sine';
        let loopMode = true;

        balanceSlider.addEventListener('input', e => updateBalance(e.target.value));
        loopToggle.addEventListener('change', e => {
            loopMode = e.target.checked;
            if (isPlaying) {
                if (!loopMode) {
                    if (soundType === 'white') {
                        source.loop = loopMode;
                    }
                    loop = setTimeout(stopAudio, 1500 /*soundType === 'sweep' ? 1500 : 3000*/)
                } else {
                    clearTimeout(loop);
                };
            };
        });

        soundBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                soundType = btn.dataset.sound;
                soundBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                playAudio();
            });
        });

        testBtn.addEventListener('click', () => isPlaying ? stopAudio() : playAudio());
        stopBtn.addEventListener('click', stopAudio);

        function updateBalance(val) {
            const num = parseInt(val);
            balanceValue.textContent = num === 0 ? "Âπ≥Ë°°: Â±Ö‰∏≠" : num < 0 ? `Âπ≥Ë°°: Â∑¶${-num}%` : `Âπ≥Ë°°: Âè≥${num}%`;
            indicator.style.left = `${10 + (num + 100) / 200 * 80}%`;
            leftSpk.classList.toggle('active', num <= 0);
            rightSpk.classList.toggle('active', num >= 0);
            if (panNode) panNode.pan.value = num / 100;
        }


        // ÂàõÂª∫ÁôΩÂô™Â£∞
        function createNoise() {
            const buffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
            const noise = ctx.createBufferSource();
            noise.buffer = buffer;
            noise.loop = loopMode;
            return noise;
        }

        // ÂàõÂª∫ÊåØËç°Âô®
        function createOscillator() {
            const osc = ctx.createOscillator();
            if (soundType === 'ping') osc.frequency.setValueAtTime(800, ctx.currentTime);
            if (soundType === 'sweep') {
                osc.frequency.setValueAtTime(200, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 1.5);
            }
            return osc;
        }

        function playAudio() {
            if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
            stopAudio();

            // Â£∞ÈÅìÂπ≥Ë°°
            panNode = ctx.createStereoPanner();
            panNode.pan.value = balanceSlider.value / 100;

            // Èü≥Èáè
            gain = ctx.createGain();
            gain.gain.value = 0.25;

            // ÂàõÂª∫Èü≥Ê∫ê
            source = soundType === 'white' ? createNoise() : createOscillator();
            source.type = soundType === 'sine' || soundType === 'ping' || soundType === 'sweep' ? 'sine' : undefined;
            if (source.start) source.start();
            source.connect(panNode).connect(gain).connect(ctx.destination);
            isPlaying = true;

            testBtn.textContent = "Êí≠Êîæ‰∏≠...";
            testBtn.classList.add('playing');
            //source.onended = () => loopMode && soundType !== 'white' ? playAudio() : stopAudio();
            if (!loopMode) {
                if (soundType === 'white') {
                    source.loop = loopMode;
                }
                loop = setTimeout(stopAudio, 1500 /*soundType === 'sweep' ? 1500 : 3000*/)
            } else {
                clearTimeout(loop);
            };
        };

        function stopAudio() {
            if (source) {
                try {
                    source.stop();
                    source.disconnect();
                } catch {
                    source.disconnect();
                }
                source = null;
            }
            if (panNode) {
                panNode.disconnect();
                panNode = null;
            }
            clearTimeout(loop);
            isPlaying = false;
            testBtn.textContent = "ÊµãËØïÂ£∞Èü≥";
            testBtn.classList.remove('playing');
            leftSpk.classList.remove('active');
            rightSpk.classList.remove('active');
        }

        function restartAudio() { stopAudio(); playAudio(); }
        updateBalance(0);
    </script>
</body>

</html>